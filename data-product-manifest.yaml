version: 0.0.8
jobId: "1308"
jobName: CRDP_Customer_Sales_360
jobType: Consumption Ready Data Product
developerId: e8366529-9833-4c2e-ad85-a094679b85cc
domain: marketing_and_sales
alias: load_it_into_crdp_sales_360
discoveryPort:
  name: CRDP_Customer_Sales_360
inputPorts:
  - alias: Vehicle_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:2c719231-1e43-4d19-bb74-f1c4b708d4fc
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Dealer_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:54ddeeb9-ff9a-4d57-8fbc-afafa0d45fe9
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Census_Master_Data_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:855271ea-f0f5-4725-9117-6a5647878b45
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Sales_Invoice_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:713be1cd-04dc-49fc-8277-816482d621ea
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
productState:
  isDynamic: true
  alias: load_it_into_crdp_sales_360
  retentionVersions: ""
  logicalSchema: ""
  stateStoreType: loadDataIceberg
  isProfilingEnabled: false
  updateStrategy: Overwrite
  tableName: msil_dataverse_marketing_and_sales_catalog.CRDP_Customer_Sales_360
  warehousePath: s3://msil-dataverse-marketing-and-sales/
  catalogName: glue
  optional:
    persistDataFrame: false
    enableDataReconciliation: false
    enforceSchema: false
    enforceSchemaMethod: Warning
    catalogType: glue
  refreshInterval: None
transformation:
  - isDynamic: true
    alias: Spark_SQL_1
    description: Transformation logic
    sequence: 5
    inputDataFrameList:
      - inputDataFrame: Vehicle_Master_1
        tempViewName: vehicle_master
      - inputDataFrame: Dealer_Master_1
        tempViewName: dealer_master
      - inputDataFrame: Census_Master_Data_1
        tempViewName: census_master_data
      - inputDataFrame: Sales_Invoice_1
        tempViewName: sales_invoice
    query: select  SI.CUSTOMER_CODE ,SI.INVOICE_NUMBER ,SI.INVOICE_TYPE ,SI.VIN
      ,SI.DEALER_MAP_CODE ,SI.LOCATION_CODE ,SI.INV_DATE ,SI.ORDER_NUM
      ,SI.CANCEL_DATE ,SI.PARENT_GROUP ,SI.COMPANY_FA ,SI.TEHSIL_CODE
      ,SI.VILLAGE_CODE ,SI.STATE_CODE ,SI.REGION_CODE ,sum(SI.INVOICE_AMOUNT) as
      INVOICE_AMOUNT ,VM.MODEL_CODE ,VM.TRANSMISSION_TYPE ,VM.VARIANT_LONG_DESC
      ,sum(SI.loyalty_redeem_amount) as loyalty_redeem_amount
      ,sum(SI.extended_warranty_booked_amount) as
      extended_warranty_booked_amount ,VM.MODEL_DESCRIPTION
      ,VM.FAMILY_MODEL_DESCRIPTION ,VM.FAMILY_MODEL_CODE ,SI.EXCHANGE_FLAG ,''
      as district_name ,'' as criteria ,'' as kpi ,'' as villages
      ,DM.Dealer_Name ,DM.Dealer_Type ,'' AS Buyer_Type ,'' AS Scheme_Name ,''
      AS Scheme_Code ,'' AS DSE_Name ,'' AS DSE_Employee_Designation from
      msil_dataverse_marketing_and_sales_catalog.sales_invoice SI  left join
      msil_dataverse_marketing_and_sales_catalog.dealer_master DM on
      DM.LOCATION_CODE = SI.LOCATION_CODE and DM.DEALER_MAP_CODE =
      SI.DEALER_MAP_CODE  and DM.parent_group = SI.parent_group  left join
      msil_dataverse_quality_assurance_catalog.ccsm_vehicle_master VM on SI.VIN
      = VM.VIN group by  SI.CUSTOMER_CODE ,SI.INVOICE_NUMBER ,SI.INVOICE_TYPE
      ,SI.VIN ,SI.DEALER_MAP_CODE ,SI.LOCATION_CODE ,SI.INV_DATE ,SI.ORDER_NUM
      ,SI.CANCEL_DATE ,SI.PARENT_GROUP ,SI.COMPANY_FA ,SI.TEHSIL_CODE
      ,SI.VILLAGE_CODE ,SI.STATE_CODE ,SI.REGION_CODE ,VM.MODEL_CODE
      ,VM.TRANSMISSION_TYPE ,VM.VARIANT_LONG_DESC ,VM.MODEL_DESCRIPTION
      ,VM.FAMILY_MODEL_DESCRIPTION ,VM.FAMILY_MODEL_CODE ,SI.EXCHANGE_FLAG
      ,DM.Dealer_Name ,DM.Dealer_Type  union all   SELECT '' as CUSTOMER_CODE
      ,'' as INVOICE_NUMBER ,'' as INVOICE_TYPE ,'' as VIN ,0.0 as
      DEALER_MAP_CODE ,'' as LOCATION_CODE ,TO_TIMESTAMP(null,'YYYY-MM-DD') as
      INV_DATE ,'' as ORDER_NUM ,TO_TIMESTAMP(null,'YYYY-MM-DD')as CANCEL_DATE
      ,'' as PARENT_GROUP ,'' as COMPANY_FA ,'' as TEHSIL_CODE ,'' as
      VILLAGE_CODE ,'' as STATE_CODE ,'' as REGION_CODE ,0.0 as INVOICE_AMOUNT
      ,'' as MODEL_CODE ,'' as TRANSMISSION_TYPE ,'' as VARIANT_LONG_DESC ,0.0
      as loyalty_redeem_amount ,0.0 as extended_warranty_booked_amount ,'' as
      MODEL_DESCRIPTION ,'' as FAMILY_MODEL_DESCRIPTION ,'' as FAMILY_MODEL_CODE
      ,'' as EXCHANGE_FLAG ,CM.district_name ,CM.criteria ,CM.kpi ,CM.villages
      ,'' as Dealer_Name ,'' as Dealer_Type ,'' AS Buyer_Type ,'' AS Scheme_Name
      ,'' AS Scheme_Code ,'' AS DSE_Name ,'' AS DSE_Employee_Designation FROM
      msil_dataverse_marketing_and_sales_catalog.census_master_data CM
    optional:
      persistDataFrame: false
    type: operationThroughSqlQuery
controlPort:
  dataQualityRules: {}
